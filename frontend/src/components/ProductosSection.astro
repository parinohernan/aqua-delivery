---
// Componente modular para la secciÃ³n de productos
---

<div class="productos-section">
  <div class="productos-header">
    <div class="header-content">
      <h2 class="section-title">
        <span class="icon">ğŸ“¦</span>
        GestiÃ³n de Productos
      </h2>
      <p class="section-subtitle">Administra tu catÃ¡logo de productos de manera eficiente</p>
    </div>
  </div>

  <div class="productos-container">
    <!-- Panel de acciones -->
    <div class="actions-panel">
      <div class="actions-header">
        <h3>âš¡ Acciones RÃ¡pidas</h3>
      </div>
      
      <div class="actions-content">
        <button onclick="window.showCreateProductModal()" class="btn-create">
          <span class="btn-icon">â•</span>
          Nuevo Producto
        </button>
        
        <div class="search-group">
          <div class="search-input-wrapper">
            <span class="search-icon">ğŸ”</span>
            <input 
              type="text" 
              id="productosSearch" 
              placeholder="Buscar productos..."
              class="search-input"
            >
          </div>
        </div>
      </div>
    </div>

    <!-- Panel de filtros -->
    <div class="filters-panel">
      <div class="filters-header">
        <h3>ğŸ” Filtros</h3>
      </div>
      
      <div class="filters-content">
        <div class="filter-group">
          <label for="filterProductosEstado" class="filter-label">
            <span class="label-icon">ğŸ“Š</span>
            Estado
          </label>
          <select id="filterProductosEstado" class="filter-select">
            <option value="todos">Todos los productos</option>
            <option value="activos">Solo activos</option>
            <option value="inactivos">Solo inactivos</option>
          </select>
        </div>
        
        <button onclick="window.clearProductosFilters()" class="btn-clear">
          <span class="btn-icon">ğŸ”„</span>
          Limpiar Filtros
        </button>
      </div>
    </div>

    <!-- Lista de productos -->
    <div class="products-area">
      <div id="productosList" class="products-container">
        <div class="empty-state">
          <div class="empty-icon">ğŸ“¦</div>
          <h4>Cargando productos...</h4>
          <p>Preparando tu catÃ¡logo de productos</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Estilos importados desde productos.css -->

<script>
  // Configurar bÃºsqueda con debounce
  document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ”§ Configurando event listeners de productos...');
    
    const searchInput = document.getElementById('productosSearch');
    if (searchInput) {
      console.log('âœ… Input de bÃºsqueda encontrado');
      let searchTimeout;
      
      searchInput.addEventListener('input', function(e) {
        const target = e.target as HTMLInputElement;
        console.log('ğŸ” Input de bÃºsqueda detectado:', target.value);
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          console.log('ğŸ” Ejecutando bÃºsqueda:', target.value);
          if (window.searchProducts) {
            window.searchProducts(target.value);
          } else {
            console.error('âŒ window.searchProducts no estÃ¡ disponible');
          }
        }, 300);
      });
      console.log('âœ… Event listener de bÃºsqueda configurado');
    } else {
      console.error('âŒ No se encontrÃ³ el input de bÃºsqueda');
    }

    // Configurar filtro de estado
    const estadoFilter = document.getElementById('filterProductosEstado');
    if (estadoFilter) {
      console.log('âœ… Selector de estado encontrado');
      estadoFilter.addEventListener('change', function(e) {
        const target = e.target as HTMLSelectElement;
        console.log('ğŸ” Cambio de estado detectado:', target.value);
        if (window.filterProductosByEstado) {
          window.filterProductosByEstado();
        } else {
          console.error('âŒ window.filterProductosByEstado no estÃ¡ disponible');
        }
      });
      console.log('âœ… Event listener de filtro de estado configurado');
    } else {
      console.error('âŒ No se encontrÃ³ el selector de estado');
    }
  });

  // FunciÃ³n para configurar event listeners cuando se carga la secciÃ³n
  function setupProductosEventListeners() {
    console.log('ğŸ”§ Configurando event listeners de productos (setupProductosEventListeners)...');
    
    // BÃºsqueda con debounce
    const searchInput = document.getElementById('productosSearch');
    if (searchInput) {
      console.log('âœ… Input de bÃºsqueda encontrado en setupProductosEventListeners');
      let searchTimeout;
      
      searchInput.addEventListener('input', function(e) {
        const target = e.target as HTMLInputElement;
        console.log('ğŸ” Input de bÃºsqueda detectado:', target.value);
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          console.log('ğŸ” Ejecutando bÃºsqueda:', target.value);
          if (window.searchProducts) {
            window.searchProducts(target.value);
          } else {
            console.error('âŒ window.searchProducts no estÃ¡ disponible');
          }
        }, 300);
      });
      console.log('âœ… Event listener de bÃºsqueda configurado');
    }

    // Filtro de estado
    const estadoFilter = document.getElementById('filterProductosEstado');
    if (estadoFilter) {
      console.log('âœ… Selector de estado encontrado en setupProductosEventListeners');
      estadoFilter.addEventListener('change', function(e) {
        const target = e.target as HTMLSelectElement;
        console.log('ğŸ” Cambio de estado detectado:', target.value);
        if (window.filterProductosByEstado) {
          window.filterProductosByEstado();
        } else {
          console.error('âŒ window.filterProductosByEstado no estÃ¡ disponible');
        }
      });
      console.log('âœ… Event listener de filtro de estado configurado');
    }
  }

  // Hacer la funciÃ³n disponible globalmente
  (window as any).setupProductosEventListeners = setupProductosEventListeners;
</script>
